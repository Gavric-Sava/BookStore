<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../../../assets/styles/common.css">
    <link rel="stylesheet" href="../../../../assets/styles/dialog.css">
    <link rel="stylesheet" href="../../../../assets/styles/form.css">
    <link rel="stylesheet" href="../../../../assets/styles/list.css">
    <link rel="stylesheet" href="../../../../assets/styles/list_authors.css">
    <link rel="stylesheet" href="../../../../assets/styles/list_books.css">
    <link href='../../../../assets/images/edit.jpg' rel='preload' as='image'>
    <link href='../../../../assets/images/create.png' rel='preload' as='image'>
    <link href='../../../../assets/images/delete.png' rel='preload' as='image'>
    <link href='../../../../assets/images/alert.png' rel='preload' as='image'>
    <title>Bookstore</title>
</head>
<body>
    <div class="container">
    </div>
<script>
    window.onload = requestAuthorList;
    window.onpopstate = popstateCallback;

    function pushState(author_id, path) {
        console.log("before pushState()");
        console.log(history.state);
        window.history.pushState({'author_id' : author_id}, '', path);
        console.log("after pushState()");
        console.log(history.state);
    }

    function popState() {
        history.back();
    }

    function popstateCallback() {
        console.log("after popState");
        console.log(history.state);
        clearContent();
        if (history.state === null || history.state.author_id === null) {
            requestAuthorList();
        } else {
            requestBookList(history.state.author_id);
        }
    }

    function clearContent() {
        const container = document.querySelector('.container');
        while (container.firstChild) {
            container.removeChild(container.lastChild);
        }
    }

    function requestAuthorList() {
        const response = fetch('http://bookstore.test/spa/authors');
        response.then(processAuthorListResponse);
    }

    function processAuthorListResponse(response) {
        if (response.status === 200) {
            response.text().then((body) => {
                console.log(body);
                body = JSON.parse(body);
                console.log(body);
                generateHTMLAuthorList(body);
            });
        }

        return null;
    }

    function generateHTMLAuthorList(author_list) {
        const container = document.querySelector('.container');

            const wrapper = document.createElement('div');
            wrapper.className = 'wrapper wrapper-list author-list';

                // list header
                const h1 = document.createElement("h1");
                h1.appendChild(document.createTextNode("Author list"));
                wrapper.appendChild(h1);

                // list table
                const table = document.createElement('table');

                    // list table columns
                    let col = document.createElement('col');
                    col.className = "first-column";
                    table.appendChild(col);
                    col = document.createElement('col');
                    col.className = "second-column";
                    table.appendChild(col);
                    col = document.createElement('col');
                    col.className = "third-column";
                    table.appendChild(col);

                    // list table headings row
                    const thead = document.createElement('thead');
                        let tr = document.createElement('tr');

                            // list table headings
                            let th = document.createElement('th');
                            th.className = 'first';
                            th.appendChild(document.createTextNode("Author"));
                            tr.append(th);


                            th = document.createElement('th');
                            th.className = 'books';
                            th.appendChild(document.createTextNode("Books"));
                            tr.append(th);

                            th = document.createElement('th');
                            th.className = 'last';
                            th.appendChild(document.createTextNode("Actions"));
                            tr.append(th);

                        thead.append(tr);

                    table.append(thead);

                // list table body
                let tbody = document.createElement('tbody');

                    // function images
                    let image_edit = document.createElement('img');
                    image_edit.src = '../../../../assets/images/edit.jpg';
                    image_edit.className = 'icon edit';

                    let image_delete = document.createElement('img');
                    image_delete.src = '../../../../assets/images/delete.png';
                    image_delete.className = 'icon';

                    let image_create = document.createElement('img');
                    image_create.src = '../../../../assets/images/create.png';
                    image_create.className = 'icon create';

                    let alert_img = document.createElement('img');
                    alert_img.src = '../../../../assets/images/alert.png';

                    // rows and columns of list table
                    for (let i = 0; i < author_list.length; i++) {
                        let author = author_list[i].author;
                        let book_count = author_list[i].book_count;
                        const tr = tbody.insertRow();

                        for (let j = 0; j < 3; j++) {
                            const td = tr.insertCell();
                            if (j === 0) {
                                const book_list_link = document.createElement('a');
                                book_list_link.href = `spa/authors/${author.id}/books`;
                                book_list_link.addEventListener('click', function(event) {
                                    event.preventDefault();
                                    pushState(author.id,`/spa/authors/${author.id}/books`);
                                    requestBookList(author.id);
                                });
                                book_list_link.appendChild(
                                    document.createTextNode(
                                        author.firstname +
                                        " " +
                                        author.lastname
                                    )
                                );
                                td.appendChild(book_list_link);
                                td.className = 'first';
                            } else if (j === 1) {
                                td.appendChild(document.createTextNode(book_count));
                                td.className = 'books';
                            } else {
                                let a = document.createElement('a');
                                // a.href = '/authors/edit/' + author.id;
                                a.addEventListener('click', function() {
                                    clearContent();
                                    pushState(null, '/spa/authors/edit/' + author.id);
                                    generateHTMLAuthorEdit(
                                        author.id,
                                        author.firstname,
                                        author.lastname,
                                    );
                                })
                                a.appendChild(image_edit.cloneNode());
                                td.appendChild(a);

                                a = document.createElement('a');
                                a.addEventListener('click', function() {
                                    clearContent();
                                    pushState(null, '/spa/authors/delete/' + author.id);
                                    generateHTMLAuthorDelete(
                                        author.id,
                                        author.firstname,
                                        author.lastname
                                    );
                                })
                                a.appendChild(image_delete.cloneNode());
                                td.appendChild(a);

                                td.className = 'last';
                            }
                        }
                    }

                table.appendChild(tbody);

                wrapper.appendChild(table);

                // create 'button'
                let a = document.createElement('a');
                a.className = 'create_link';
                a.appendChild(image_create);
                a.addEventListener('click', function() {
                    clearContent();
                    pushState(null, '/spa/authors/create');
                    generateHTMLAuthorCreate();
                });
                wrapper.appendChild(a);

            container.appendChild(wrapper);
    }

    function generateHTMLAuthorCreate() {
        const container = document.querySelector('.container');

            const wrapper = document.createElement('div');
            wrapper.className = 'wrapper wrapper-form';

                // header div
                const header = document.createElement("div");
                header.className = 'header';

                    // header span
                    const header_span = document.createElement('span');
                    header_span.appendChild(document.createTextNode('Author Create'));
                    header.appendChild(header_span);

                wrapper.appendChild(header);

                // form
                const form = document.createElement('form');
                form.method = 'post';
                form.addEventListener("submit", submitCreateAuthorInput, true);

                    // first name div
                    const first_name_div = document.createElement('div');
                    first_name_div.className = 'form-item';

                        // first name label
                        const first_name_label = document.createElement('span');
                        first_name_label.appendChild(document.createTextNode('First name'));
                        first_name_div.appendChild(first_name_label);

                        // first name input
                        const first_name_input = document.createElement('input');
                        first_name_input.type = 'text';
                        first_name_input.name = 'first_name';
                        first_name_div.appendChild(first_name_input);

                        // first name error span
                        const first_name_error = document.createElement('span');
                        first_name_error.className = 'error first_name_error';
                        first_name_div.appendChild(first_name_error);

                    form.appendChild(first_name_div);

                    // last name div
                    const last_name_div = document.createElement('div');
                    last_name_div.className = 'form-item';

                        // last name label
                        const last_name_label = document.createElement('span');
                        last_name_label.appendChild(document.createTextNode('Last name'));
                        last_name_div.appendChild(last_name_label);

                        // last name input
                        const last_name_input = document.createElement('input');
                        last_name_input.type = 'text';
                        last_name_input.name = 'last_name';
                        last_name_div.appendChild(last_name_input);

                        // last name error span
                        const last_name_error = document.createElement('span');
                        last_name_error.className = 'error last_name_error';
                        last_name_div.appendChild(last_name_error);

                    form.appendChild(last_name_div);

                    const button_div = document.createElement('div');
                    button_div.className = 'button';

                        const submit_button = document.createElement('input');
                        submit_button.type = 'submit';
                        submit_button.name = 'submit';
                        submit_button.value = 'Save';
                        button_div.appendChild(submit_button);

                    form.appendChild(button_div);

                wrapper.appendChild(form);

            container.appendChild(wrapper);
    }

    function submitCreateAuthorInput(event) {
        event.preventDefault();

        const httpRequest = new XMLHttpRequest();
        if (!httpRequest) {
            return false;
        }

        httpRequest.onreadystatechange = function() {
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status === 200) {
                    clearContent();
                    popState();
                } else if (httpRequest.status === 400) {
                    updateAuthorCreate(JSON.parse(httpRequest.responseText));
                } else {
                    process404Response();
                }
            }
        };

        httpRequest.open('POST', 'http://bookstore.test/spa/authors/create');
        const first_name_param = 'first_name=' + document.getElementsByName('first_name')[0].value;
        const last_name_param = 'last_name=' + document.getElementsByName('last_name')[0].value;

        httpRequest.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        httpRequest.send(first_name_param + '&' + last_name_param);
    }

    function updateAuthorCreate(response) {
        document.getElementsByName('first_name')[0].value = response.first_name;
        if ('first_name_error' in response) {
            document.getElementsByClassName('first_name_error')[0].textContent = response.first_name_error;
        }

        document.getElementsByName('last_name')[0].value = response.last_name;
        if ('last_name_error' in response) {
            document.getElementsByClassName('last_name_error')[0].textContent = response.last_name_error;
        }
    }

    function generateHTMLAuthorEdit(id, firstname, lastname) { // TODO DRY
        const container = document.querySelector('.container');

            const wrapper = document.createElement('div');
            wrapper.className = 'wrapper wrapper-form';

                // header div
                const header = document.createElement("div");
                header.className = 'header';

                    // header span
                    const header_span = document.createElement('span');
                    header_span.appendChild(document.createTextNode('Author Create ' + id));
                    header.appendChild(header_span);

                wrapper.appendChild(header);

                // form
                const form = document.createElement('form');
                form.method = 'post';
                form.addEventListener("submit", function(event) {
                    submitEditAuthorInput(event, id);
                }, true);

                    // first name div
                    const first_name_div = document.createElement('div');
                    first_name_div.className = 'form-item';

                        // first name label
                        const first_name_label = document.createElement('span');
                        first_name_label.appendChild(document.createTextNode('First name'));
                        first_name_div.appendChild(first_name_label);

                        // first name input
                        const first_name_input = document.createElement('input');
                        first_name_input.type = 'text';
                        first_name_input.name = 'first_name';
                        first_name_input.value = firstname;
                        first_name_div.appendChild(first_name_input);

                        // first name error span
                        const first_name_error = document.createElement('span');
                        first_name_error.className = 'error first_name_error';
                        first_name_div.appendChild(first_name_error);

                    form.appendChild(first_name_div);

                    // last name div
                    const last_name_div = document.createElement('div');
                    last_name_div.className = 'form-item';

                        // last name label
                        const last_name_label = document.createElement('span');
                        last_name_label.appendChild(document.createTextNode('Last name'));
                        last_name_div.appendChild(last_name_label);

                        // last name input
                        const last_name_input = document.createElement('input');
                        last_name_input.type = 'text';
                        last_name_input.name = 'last_name';
                        last_name_input.value = lastname;
                        last_name_div.appendChild(last_name_input);

                        // last name error span
                        const last_name_error = document.createElement('span');
                        last_name_error.className = 'error last_name_error';
                        last_name_div.appendChild(last_name_error);

                    form.appendChild(last_name_div);

                    const button_div = document.createElement('div');
                    button_div.className = 'button';

                        const submit_button = document.createElement('input');
                        submit_button.type = 'submit';
                        submit_button.name = 'submit';
                        submit_button.value = 'Save';
                        button_div.appendChild(submit_button);

                    form.appendChild(button_div);

                wrapper.appendChild(form);

            container.appendChild(wrapper);
    }

    function submitEditAuthorInput(event, id) {
        event.preventDefault();

        const httpRequest = new XMLHttpRequest();
        if (!httpRequest) {
            return false;
        }

        httpRequest.onreadystatechange = function() {
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status === 200) {
                    clearContent();
                    popState();
                } else if (httpRequest.status === 400) {
                    alert(httpRequest.responseText);
                    updateAuthorEdit(JSON.parse(httpRequest.responseText));
                } else {
                    process404Response();
                }
            }
        };

        httpRequest.open('POST', 'http://bookstore.test/spa/authors/edit/' + id);
        const first_name_param = 'first_name=' + document.getElementsByName('first_name')[0].value;
        const last_name_param = 'last_name=' + document.getElementsByName('last_name')[0].value;

        httpRequest.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        httpRequest.send(first_name_param + '&' + last_name_param);
    }

    function updateAuthorEdit(response) {
        document.getElementsByName('first_name')[0].value = response.first_name;
        if ('first_name_error' in response) {
            document.getElementsByClassName('first_name_error')[0].textContent = response.first_name_error;
        }

        document.getElementsByName('last_name')[0].value = response.last_name;
        if ('last_name_error' in response) {
            document.getElementsByClassName('last_name_error')[0].textContent = response.last_name_error;
        }
    }

    function generateHTMLAuthorDelete(id, firstname, lastname) {
        const container = document.querySelector('.container');

            const wrapper = document.createElement('div');
            wrapper.className = 'wrapper wrapper-dialog';

                const header = document.createElement('div');
                header.className = 'header';

                    const alert_img = document.createElement('img');
                    alert_img.src = '../../../../../assets/images/alert.png';
                    header.appendChild(alert_img);

                    const header_h2 = document.createElement('h2');
                    header_h2.appendChild(document.createTextNode('Delete Author'));
                    header.appendChild(header_h2);

                wrapper.appendChild(header_h2);

                const text = document.createElement('div');
                text.className = 'text';
                text.appendChild(document.createTextNode(
                    'You are about to delete the author ' + firstname + ' ' + lastname + '.\n' +
                    'If you proceed with this action Application will permanently delete all books related to this author.'
                ));
                wrapper.appendChild(text);

                const form = document.createElement('form');
                form.addEventListener('submit', function(event) {
                    submitDeleteAuthor(event, id);
                });
                form.method = 'post';
                form.className = 'buttons';

                    const btn_delete = document.createElement('button');
                    btn_delete.type = 'submit';
                    btn_delete.className = 'delete';
                    btn_delete.appendChild(document.createTextNode('Delete'));
                    form.appendChild(btn_delete);

                    const btn_cancel = document.createElement('button');
                    btn_cancel.addEventListener('click', function(event) {
                        event.preventDefault();
                        popState();
                    })
                    btn_cancel.className = 'cancel';
                    btn_cancel.appendChild(document.createTextNode('Cancel'));
                    form.appendChild(btn_cancel);

                wrapper.appendChild(form);

            container.appendChild(wrapper);
    }

    function submitDeleteAuthor(event, id) {
        event.preventDefault();

        const httpRequest = new XMLHttpRequest();
        if (!httpRequest) {
            return false;
        }

        httpRequest.onreadystatechange = function() {
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status !== 404) {
                    alert(httpRequest.responseText);
                    clearContent();
                    popState();
                }
                else {
                    process404Response();
                }
            }
        };

        httpRequest.open('POST', 'http://bookstore.test/spa/authors/delete/' + id);
        httpRequest.send();
    }

    function requestBookList(author_id) {
        const response = fetch(`http://bookstore.test/spa/authors/${author_id}/books`);
        response.then((response) => processBookListResponse(response, author_id));
    }

    function processBookListResponse(response, author_id) {
        if (response.status === 200) {
            response.text().then((body) => {
                body = JSON.parse(body);
                clearContent();
                generateHTMLBookList(body);
            });
        }

        return null;
    }

    function generateHTMLBookList(book_list) {
        const container = document.querySelector('.container');

            const wrapper = document.createElement('div');
            wrapper.className = 'wrapper wrapper-list book-list';

                // list header
                const h1 = document.createElement("h1");
                h1.appendChild(document.createTextNode("Book list"));
                wrapper.appendChild(h1);

                // list table
                const table = document.createElement('table');

                    // list table columns
                    let col = document.createElement('col');
                    col.className = "first-column";
                    table.appendChild(col);
                    col = document.createElement('col');
                    col.className = "second-column last";
                    table.appendChild(col);

                    // list table headings row
                    const thead = document.createElement('thead');
                    let tr = document.createElement('tr');

                        // list table headings
                        let th = document.createElement('th');
                        th.className = 'first';
                        th.appendChild(document.createTextNode("Book"));
                        tr.append(th);

                        th = document.createElement('th');
                        th.className = 'last';
                        th.appendChild(document.createTextNode("Actions"));
                        tr.append(th);

                    thead.append(tr);

                table.append(thead);

                    // list table body
                    let tbody = document.createElement('tbody');

                        // function images
                        let image_edit = document.createElement('img');
                        image_edit.src = '../../../../../assets/images/edit.jpg';
                        image_edit.className = 'icon edit';

                        let image_delete = document.createElement('img');
                        image_delete.src = '../../../../../assets/images/delete.png';
                        image_delete.className = 'icon';

                        let image_create = document.createElement('img');
                        image_create.src = '../../../../../assets/images/create.png';
                        image_create.className = 'icon create';

                        // rows and columns of list table
                        for (let i = 0; i < book_list.length; i++) {
                            let book = book_list[i];
                            const tr = tbody.insertRow();

                            for (let j = 0; j < 2; j++) {
                                const td = tr.insertCell();
                                if (j === 0) {
                                    td.appendChild(
                                        document.createTextNode(
                                            book.title +
                                            " " +
                                            book.year
                                        )
                                    );
                                    td.className = 'first';
                                } else {
                                    let a = document.createElement('a');
                                    a.addEventListener('click', function() {
                                        clearContent();
                                        pushState(null, `/spa/authors/books/edit/${book.id}`);
                                        generateHTMLBookEdit(
                                            book.id,
                                            book.title,
                                            book.year,
                                            book.author_id
                                        );
                                    })
                                    a.appendChild(image_edit.cloneNode());
                                    td.appendChild(a);

                                    a = document.createElement('a');
                                    a.addEventListener('click', function() {
                                        clearContent();
                                        pushState(null, `/spa/authors/books/delete/${book.id}`);
                                        generateHTMLBookDelete(
                                            book.id,
                                            book.title,
                                            book.year,
                                            book.author_id
                                        );
                                    })
                                    a.appendChild(image_delete.cloneNode());
                                    td.appendChild(a);

                                    td.className = 'last';
                                }
                            }
                        }

        table.appendChild(tbody);

        wrapper.appendChild(table);

        // create 'button'
        let a = document.createElement('a');
        a.className = 'create_link';
        a.appendChild(image_create);
        a.addEventListener('click', function() {
            clearContent();
            pushState(history.state.author_id, `/spa/authors/${history.state.author_id}/books/create`);
            generateHTMLBookCreate();
        });
        wrapper.appendChild(a);

        container.appendChild(wrapper);
    }

    function generateHTMLBookEdit(id, title, year, author_id) {
        const container = document.querySelector('.container');

        const wrapper = document.createElement('div');
        wrapper.className = 'wrapper wrapper-form';

        // header div
        const header = document.createElement("div");
        header.className = 'header';

        // header span
        const header_span = document.createElement('span');
        header_span.appendChild(document.createTextNode('Book Edit ' + id));
        header.appendChild(header_span);

        wrapper.appendChild(header);

        // form
        const form = document.createElement('form');
        form.method = 'post';
        form.addEventListener("submit", function(event) {
            submitEditBookInput(event, id, author_id);
        }, true);

        // title div
        const title_div = document.createElement('div');
        title_div.className = 'form-item';

        // title label
        const title_label = document.createElement('span');
        title_label.appendChild(document.createTextNode('Title'));
        title_div.appendChild(title_label);

        // title input
        const title_input = document.createElement('input');
        title_input.type = 'text';
        title_input.name = 'title';
        title_input.value = title;
        title_div.appendChild(title_input);

        // title error span
        const title_error = document.createElement('span');
        title_error.className = 'error';
        title_div.appendChild(title_error);

        form.appendChild(title_div);

        // year div
        const year_div = document.createElement('div');
        year_div.className = 'form-item';

        // year label
        const year_label = document.createElement('span');
        year_label.appendChild(document.createTextNode('Year'));
        year_div.appendChild(year_label);

        // year input
        const year_input = document.createElement('input');
        year_input.type = 'text';
        year_input.name = 'year';
        year_input.value = year;
        year_div.appendChild(year_input);

        // year error span
        const year_error = document.createElement('span');
        year_error.className = 'error';
        year_div.appendChild(year_error);

        form.appendChild(year_div);

        const button_div = document.createElement('div');
        button_div.className = 'button';

        const submit_button = document.createElement('input');
        submit_button.type = 'submit';
        submit_button.name = 'submit';
        submit_button.value = 'Save';
        button_div.appendChild(submit_button);

        form.appendChild(button_div);

        wrapper.appendChild(form);

        container.appendChild(wrapper);
    }

    function submitEditBookInput(event, id, author_id) {
        event.preventDefault();

        const httpRequest = new XMLHttpRequest();
        if (!httpRequest) {
            return false;
        }

        httpRequest.onreadystatechange = function() {
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status === 200) {
                    clearContent(); // TODO test
                    popState();
                } else if (httpRequest.status === 400) {
                    alert(httpRequest.responseText);
                    updateBookEdit(JSON.parse(httpRequest.responseText));
                } else {
                    process404Response();
                }
            }
        };

        httpRequest.open('POST', `http://bookstore.test/spa/authors/${author_id}/books/edit/${id}`);
        const title_param = 'title=' + document.getElementsByName('title')[0].value;
        const year_param = 'year=' + document.getElementsByName('year')[0].value;

        httpRequest.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        httpRequest.send(title_param + '&' + year_param);
    }

    function updateBookEdit(response) {
        document.getElementsByName('title')[0].value = response.title;
        if ('title_error' in response) {
            document.getElementsByClassName('title_error')[0].textContent = response.title_error;
        }

        document.getElementsByName('year')[0].value = response.year;
        if ('year_error' in response) {
            document.getElementsByClassName('year_error')[0].textContent = response.year_error;
        }
    }

    function generateHTMLBookDelete(id, title, year, author_id) {
        const container = document.querySelector('.container');

        const wrapper = document.createElement('div');
        wrapper.className = 'wrapper wrapper-dialog';

        const header = document.createElement('div');
        header.className = 'header';

        const alert_img = document.createElement('img');
        alert_img.src = '../../../../../assets/images/alert.png';
        header.appendChild(alert_img);

        const header_h2 = document.createElement('h2');
        header_h2.appendChild(document.createTextNode('Delete Author'));
        header.appendChild(header_h2);

        wrapper.appendChild(header_h2);

        const text = document.createElement('div');
        text.className = 'text';
        text.appendChild(document.createTextNode(
            'You are about to delete the book ' + title + '(' + year + ').'
        ));
        wrapper.appendChild(text);

        const form = document.createElement('form');
        form.addEventListener('submit', function(event) {
            submitDeleteBook(event, id, author_id);
        });
        form.method = 'post';
        form.className = 'buttons';

        const btn_delete = document.createElement('button');
        btn_delete.type = 'submit';
        btn_delete.className = 'delete';
        btn_delete.appendChild(document.createTextNode('Delete'));
        form.appendChild(btn_delete);

        const btn_cancel = document.createElement('button');
        btn_cancel.addEventListener('click', function(event) {
            event.preventDefault();
            popState();
        })
        btn_cancel.className = 'cancel';
        btn_cancel.appendChild(document.createTextNode('Cancel'));
        form.appendChild(btn_cancel);

        wrapper.appendChild(form);

        container.appendChild(wrapper);
    }

    function submitDeleteBook(event, id, author_id) {
        event.preventDefault();

        const httpRequest = new XMLHttpRequest();
        if (!httpRequest) {
            return false;
        }

        httpRequest.onreadystatechange = function() {
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status !== 404) {
                    alert(httpRequest.responseText);
                    clearContent();
                    popState();
                    // requestAuthorList();
                }
                else {
                    process404Response();
                }
            }
        };

        httpRequest.open('POST', `http://bookstore.test/spa/authors/${author_id}/books/delete/${id}`);
        httpRequest.send();
    }

    function generateHTMLBookCreate() {
        const container = document.querySelector('.container');

        const wrapper = document.createElement('div');
        wrapper.className = 'wrapper wrapper-form';

        // header div
        const header = document.createElement("div");
        header.className = 'header';

        // header span
        const header_span = document.createElement('span');
        header_span.appendChild(document.createTextNode('Book Create'));
        header.appendChild(header_span);

        wrapper.appendChild(header);

        // form
        const form = document.createElement('form');
        form.method = 'post';
        form.addEventListener("submit", submitCreateBookInput, true);

        // title div
        const title_div = document.createElement('div');
        title_div.className = 'form-item';

        // title label
        const title_label = document.createElement('span');
        title_label.appendChild(document.createTextNode('Title'));
        title_div.appendChild(title_label);

        // title input
        const title_input = document.createElement('input');
        title_input.type = 'text';
        title_input.name = 'title';
        title_div.appendChild(title_input);

        // title error span
        const title_error = document.createElement('span');
        title_error.className = 'error';
        title_div.appendChild(title_error);

        form.appendChild(title_div);

        // year div
        const year_div = document.createElement('div');
        year_div.className = 'form-item';

        // year label
        const year_label = document.createElement('span');
        year_label.appendChild(document.createTextNode('Year'));
        year_div.appendChild(year_label);

        // year input
        const year_input = document.createElement('input');
        year_input.type = 'text';
        year_input.name = 'year';
        year_div.appendChild(year_input);

        // year error span
        const year_error = document.createElement('span');
        year_error.className = 'error';
        year_div.appendChild(year_error);

        form.appendChild(year_div);

        const button_div = document.createElement('div');
        button_div.className = 'button';

        const submit_button = document.createElement('input');
        submit_button.type = 'submit';
        submit_button.name = 'submit';
        submit_button.value = 'Save';
        button_div.appendChild(submit_button);

        form.appendChild(button_div);

        wrapper.appendChild(form);

        container.appendChild(wrapper);
    }

    function submitCreateBookInput(event) {
        event.preventDefault();

        const httpRequest = new XMLHttpRequest();
        if (!httpRequest) {
            return false;
        }

        httpRequest.onreadystatechange = function() {
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status === 200) {
                    popState();
                    clearContent();
                    requestBookList();
                } else if (httpRequest.status === 400) {
                    updateBookCreate(JSON.parse(httpRequest.responseText));
                } else {
                    process404Response();
                }
            }
        };

        httpRequest.open('POST', `http://bookstore.test/spa/authors/${history.state.author_id}/books/create`);
        const title_param = 'title=' + document.getElementsByName('title')[0].value;
        const year_param = 'year=' + document.getElementsByName('year')[0].value;

        httpRequest.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        httpRequest.send(title_param + '&' + year_param);
    }

    function updateBookCreate(response) {
        document.getElementsByName('title')[0].value = response.title;
        if ('title_error' in response) {
            document.getElementsByClassName('title_error')[0].textContent = response.title_error;
        }

        document.getElementsByName('year')[0].value = response.year;
        if ('year_error' in response) {
            document.getElementsByClassName('year_error')[0].textContent = response.year_error;
        }
    }

    function process404Response(response) {
        clearContent();
        generateHTML404();
    }

    function generateHTML404() {
        const container = document.querySelector('.container');

            const h1 = document.createElement('h1');
            h1.appendChild(document.createTextNode('Error 404 - Page not found!'));

            container.appendChild(h1);
    }
</script>
</body>
</html>