<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../../../assets/styles/list.css">
    <link rel="stylesheet" href="../../../../assets/styles/list_authors.css">
    <title>Bookstore</title>
</head>
<body>
    <div class="wrapper">

    </div>
<script>
window.onload = function() {
    // console.log("Hello world!");
    // document.querySelector('.wrapper').appendChild(new DOMParser().parseFromString("<h1>Hello world!</h1>", 'text/html').documentElement);
    const response = fetch('http://bookstore.test/spa/authors');
    response.then(processAuthorListResponse);
}

function processAuthorListResponse(response) {
    if (response.status === 200) {
        response.json().then((body) => {
            console.log(body);
            generateHTMLAuthorList(body);
        });
    }

    return null;
}

function generateHTMLAuthorList(author_list) {
    const wrapper = document.querySelector('.wrapper');
    const node = document.createElement("h1");
    node.appendChild(document.createTextNode("Author list"));
    wrapper.appendChild(node);

    const table = document.createElement('table');

    // create columns
    let col = document.createElement('col');
    col.className = "first-column";
    table.appendChild(col);
    col = document.createElement('col');
    col.className = "second-column";
    table.appendChild(col);
    col = document.createElement('col');
    col.className = "third-column";
    table.appendChild(col);

    // create headings
    const thead = document.createElement('thead');
    let tr = document.createElement('tr');

    let th = document.createElement('th');
    let heading = document.createTextNode("Author");
    th.className = 'first';
    th.appendChild(heading);
    tr.append(th);


    th = document.createElement('th');
    heading = document.createTextNode("Books");
    th.className = 'books';
    th.appendChild(heading);
    tr.append(th);

    th = document.createElement('th');
    heading = document.createTextNode("Actions");
    th.className = 'last';
    th.appendChild(heading);
    tr.append(th);
    thead.append(tr);
    table.append(thead);

    let tbody = document.createElement('tbody');

    let image_edit = document.createElement('img');
    image_edit.src = '../../../../../assets/images/edit.jpg';
    image_edit.className = 'icon edit';

    let image_delete = document.createElement('img');
    image_delete.src = '../../../../../assets/images/delete.png';
    image_delete.className = 'icon';

    let image_create = document.createElement('img');
    image_create.src = '../../../../../assets/images/create.png';
    image_create.className = 'icon create';

    for (let i = 0; i < author_list.length; i++) {
        const tr = tbody.insertRow();
        for (let j = 0; j < 3; j++) {
            const td = tr.insertCell();
            if (j === 0) {
                td.appendChild(document.createTextNode(author_list[i].author.firstname + " " + author_list[i].author.lastname));
                td.className = 'first';
            } else if (j === 1) {
                td.appendChild(document.createTextNode(author_list[i].book_count));
                td.className = 'books';
            } else {
                let a = document.createElement('a');
                a.href = '/authors/edit/' + author_list[i].author.id;
                a.appendChild(image_edit.cloneNode());
                td.appendChild(a);

                a = document.createElement('a');
                a.href = '/authors/delete/' + author_list[i].author.id;
                a.appendChild(image_delete.cloneNode());
                td.appendChild(a);

                td.className = 'last';
            }

        }
    }

    table.appendChild(tbody);
    wrapper.appendChild(table);

    let a = document.createElement('a');
    a.href = '/authors/create';
    a.className = 'create_link';
    a.appendChild(image_create);

    wrapper.appendChild(a);
}
</script>
<script>
    // document.addEventListener('click', (event) => {
    //     if (
    //         // if you clicked on an A-nchor tag (link)
    //         event.target.tagName === 'A' &&
    //         // and you're going to a page on this domain (like /desert)
    //         event.target.origin === location.origin
    //     ) {
    //         // don't ask the server for that resource!
    //         event.preventDefault()
    //         // instead, we'll go fetch the resource ourselves
    //         const response = fetch('https://buffet.table/desert')
    //         // ...convert that response to something we can work with
    //         const htmlString = await response.text()
    //         const desert = new DOMParser()
    //             .parseFromString(htmlString, 'text/html')
    //
    //         // ...and do something with that desert element
    //         // ex. append desert to our "plate" in the DOM
    //         document.querySelector('.my-plate').appendChild(desert)
    //     }
    // })
</script>
</body>
</html>